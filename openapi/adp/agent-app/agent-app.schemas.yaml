components:
  schemas:
    CreateConversationRequest:
      type: object
      description: 创建会话请求体。
      properties:
        agent_id:
          type: string
          description: agent ID。
        agent_version:
          type: string
          description: agent 版本，“v0“表示最新版本
        executor_version:
          type: string
          description: 智能体执行引擎版本，最新为“v2“
      required:
        - agent_id
        - agent_version

    ChatCompletionRequest:
      type: object
      description: 对话请求体。
      properties:
        agent_id:
          type: string
          description: agent ID。
        agent_version:
          type: string
          description: agent 版本，“latest“表示最新版本
          enum: [latest]
        executor_version:
          type: string
          description: 智能体执行引擎版本，最新为“v2“
          enum: [v2]
        conversation_id:
          type: string
          description: 会话 ID。
        custom_querys:
          type: object
          description: 传给智能体的额外参数
        query:
          type: string
          description: 用户输入的问题。
        stream:
          type: boolean
          description: 是否流式返回。
      required:
        - query
        - agent_id
        - agent_version
        - executor_version
        - conversation_id
        - stream

    EventMessage:
      type: object
      desciption: Event Stream Message
      properties:
        seq_id:
          type: integer
          description: Event Message 序号
        key:
          type: array
          items:
            oneOf:
            - type: string
            - type: integer
          description: 要操作的对象的属性路径。数字表示数组下标，字符串表示对象属性名
        action:
          type: string
          enum: [append, upsert]
          description: |
            对象属性的操作类型：
              - append：向数组追加元素或在文本后追加内容
              - upsert：插入对象属性
        content:
          type: 
            oneOf:
            - type: string
            - type: integer
            - $ref: "#/components/schemas/Message"
            - $ref: "#/components/schemas/Progress"
            - $ref: "#/components/schemas/LLMAnswer"
            - $ref: "#/components/schemas/ToolAnswer"
          description: 表示要 upsert 或 append 的内容
    
    Message:
      index:
        type: int
        description: 消息下标，用于前端消息排序
      id:
        type: string
        description: 消息 ID
      conversation_id:
        type: string
        description: 会话 ID
      role:
        type: string
        enum: [user, assistant]
      content:
        type: object
        properties: 
          final_answer:
            $ref: "#/components/schemas/FinalAnswer"
          middle_answer:
            $ref: "#/components/schemas/MiddleAnswer"
  
    FinalAnswer:
      type: object
      description: 智能体最终的输出
      properties:
        thinking:
          type: string
        answer:
          type: object
          properties:
            text:
              type: string
              description: 智能体最终输出的文本内容
      
    MiddleAnswer:
      type: object
      description: 智能体执行过程中的输出
      properties:
        progress:
          type: array
          items:
            $ref: "#/components/schemas/Progress"
    
    Progress:
      type: object
      description: 智能体执行过程中的一个步骤
      properties:
        stage:
          type: string
          description: |
            步骤的类型：
              - llm：表示大模型输出
              - skill：表示技能调用
              - assign: 变量赋值
          enum: [llm, skill, assign]
        answer:
          oneOf:
          - $ref: "#/components/schemas/LLMAnswer"
          - $ref: "#/components/schemas/ToolAnswer"
        think:
          type: string
          description: 执行步骤中的思考过程
        status:
          type: string
          description: 步骤的执行状态
          enum: [processing, completed]
        skill_info:
          $ref: "#/components/schemas/SkillInfo"
  
    LLMAnswer:
      type: string
      description: 当 stage 为 “llm” 时表示大模型输出的文本
      
    ToolAnswer:
      type: object
      description: 当 stage 为 “skill” 时表示调用技能的输入输出
      properties:
        choices: array
        description: 调用工具。返回多个表示调用了多次工具
        items:
          type: object
          properties:
            message:
              type: object
              description: 技能消息
              properties:
                role:
                  type: string
                  enum: [tool]
                tool_calls:
                  type: array
                  description: 单次工具调用的输入输出
                  prefixItems:
                  - oneOf:
                    - $ref: "#/components/schemas/ToolCall"
                  items:
                    oneOf:
                    - $ref: "#/components/schemas/ToolResult"
    
    ToolCall:
      type: object
      description: 调用工具的输入
      oneOf:
      - "#/components/schemas/SearchIntent"
    
    ToolResult:
      type: object
      description: 调用工具的输出结果
      oneOf:
      - "#/components/schemas/SearchResult"
    
    SearchIntent:
      type: object
      description: 智谱搜索工具的输入查询
      properties:
        type:
          type: string
          enum: [search_intent]
        search_intent:
          type: object
          description: 搜索参数
          properties:
            keywords:
              type: string
            query:
              type: string
            intent:
              type: string
              enum: [SEARCH_ALL]
    
    SearchResult:
      type: object
      description: 智谱搜索工具的返回结果
      properties:
        type: 
          type: string
          enum: [search_result]
        search_result:
          type: array
          items:
            type: object
            properties:
              icon:
                type: string
                description: 搜索结果的来源网站图标 URL
              link:
                type: string
                description: 搜索结果的来源地址
              media:
                type: string
                description: 搜索结果的来源网站名称
              title:
                type: string
                description: 搜索结果的来源文章标题
              content:
                type: string
                description: 搜索结果的内容摘要
    
    SkillInfo:
      type: object
      desciption: 调用技能的技能详情
      properties:
        type:
          type: string
          description: |
            技能类型：
            - TOOL：工具
            - MCP：MCP 协议
            - AGENT：调用其他智能体
          enum: [TOOL, MCP, AGENT]
        name:
          type: string
          desciption: 技能名称
        args:
          type: array
          desciption: 技能参数
          items:
            type: object
            properties:
              name:
                type: string
                desciption: 参数名
              type:
                type: string
                desciption: 参数类型
                enum: [str]
              value:
                desciption: 参数值
                type: string
      
